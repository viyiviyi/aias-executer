# 文档大纲功能升级说明

## 概述

已将原有的 `read_code_object_tree` 功能升级为 `get_document_outline` 功能，支持更多编程语言和文件格式，提供更好的代码定位能力。

## 主要改进

### 1. 功能重命名
- 从 `read_code_object_tree` 改为 `get_document_outline`
- 更准确地描述功能用途

### 2. 支持更多语言和格式
支持以下编程语言和文件格式：
- **编程语言**: C#, Java, JavaScript, TypeScript, Python, C, C++, Go, Kotlin
- **标记语言**: HTML, JSX
- **数据格式**: JSON, YAML

### 3. 智能深度控制
- 对于JSON和YAML文件，默认最多读取3层
- 可通过 `max_depth` 参数调整深度限制

### 4. 增强的输出结构
返回的文档大纲包含：
- **行号信息**: 精确到每一行，便于代码定位
- **嵌套层级**: 显示项目的嵌套关系
- **类型信息**: 区分函数、类、接口、属性等
- **签名信息**: 包含完整的定义签名
- **注释内容**: 提取相关注释

### 5. 自动语言检测
根据文件扩展名和内容自动检测编程语言

## 使用方法

### 基本调用
```json
{
  "tool": "get_document_outline",
  "parameters": {
    "path": "example.ts"
  }
}
```

### 带参数调用
```json
{
  "tool": "get_document_outline",
  "parameters": {
    "path": "config.json",
    "max_depth": 3,
    "encoding": "utf-8"
  }
}
```

## 输出示例

### TypeScript文件大纲
```json
{
  "success": true,
  "result": {
    "outline": [
      {
        "name": "User",
        "type": "interface",
        "line": 6,
        "level": 0,
        "signature": "export interface User",
        "comment": "用户接口"
      },
      {
        "name": "UserService",
        "type": "class",
        "line": 12,
        "level": 0,
        "signature": "export class UserService",
        "comment": "用户服务类",
        "children": [
          {
            "name": "addUser",
            "type": "method",
            "line": 17,
            "level": 1,
            "signature": "addUser(user: User): void",
            "comment": "添加用户"
          }
        ]
      }
    ],
    "total_items": 4,
    "file_path": "/path/to/example.ts",
    "file_name": "example.ts",
    "file_extension": ".ts",
    "file_size": 1024,
    "last_modified": "2024-01-01T00:00:00.000Z",
    "language": "typescript"
  }
}
```

### JSON文件大纲（最多3层）
```json
{
  "success": true,
  "result": {
    "outline": [
      {
        "name": "app",
        "type": "object",
        "line": 2,
        "level": 0,
        "children": [
          {
            "name": "name",
            "type": "property",
            "line": 3,
            "level": 1,
            "signature": "\"name\": \"MyApp\""
          },
          {
            "name": "settings",
            "type": "object",
            "line": 5,
            "level": 1,
            "children": [
              {
                "name": "debug",
                "type": "property",
                "line": 6,
                "level": 2,
                "signature": "\"debug\": true"
              }
            ]
          }
        ]
      }
    ],
    "total_items": 4,
    "file_path": "/path/to/config.json",
    "file_name": "config.json",
    "file_extension": ".json",
    "file_size": 512,
    "last_modified": "2024-01-01T00:00:00.000Z",
    "language": "json"
  }
}
```

## 语言支持详情

### TypeScript/JavaScript
- 类 (class)
- 函数 (function)
- 接口 (interface)
- 类型别名 (type)
- 常量 (const)
- 变量 (let/var)
- 导入/导出语句

### Python
- 类 (class)
- 函数 (def)
- 模块级变量

### Java/C#
- 类 (class)
- 方法 (method)
- 接口 (interface)

### C/C++
- 函数
- 结构体/类 (struct/class)

### Go
- 函数 (func)
- 结构体 (struct)
- 接口 (interface)

### Kotlin
- 类 (class)
- 函数 (fun)
- 数据类 (data class)

### HTML/JSX
- 元素标签
- 包含id和class属性作为名称

### JSON/YAML
- 对象/属性
- 数组项
- 深度限制（默认3层）

## 向后兼容性

旧的 `read_code_object_tree` 工具已被注释掉，但代码仍保留在项目中。如果需要完全移除，可以：
1. 删除 `src/tools/file/read-code-object-tree.ts` 文件
2. 从 `src/tools/index.ts` 中移除相关导入

## 性能考虑

1. **文件大小限制**: 受限于现有的 `maxFileSize` 配置
2. **递归深度**: JSON/YAML默认限制3层，防止无限递归
3. **内存使用**: 大型文件解析时注意内存使用

## 测试文件

在 `workspace` 目录中创建了测试文件：
- `test-typescript.ts` - TypeScript示例
- `test-config.json` - JSON示例
- `test-python.py` - Python示例
- `test-outline.js` - 功能验证脚本

## 下一步计划

1. **更精确的行号计算**: 改进JSON/YAML的行号定位
2. **更多语言支持**: 添加对Swift、Rust、PHP等语言的支持
3. **性能优化**: 优化大型文件的解析性能
4. **缓存机制**: 添加解析结果缓存

## 注意事项

1. 新功能需要重启服务后才能生效
2. 对于不支持的文件类型，会返回基本的大纲信息
3. 复杂的代码结构可能无法完全解析，但会尽力提供有用信息